<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professor Michael McIntyre - Life Story Timeline</title>
    <script type="text/javascript" src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <link href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
    <style>
        /* For a more polished look, consider importing a font like Inter:
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body, html { font-family: 'Inter', sans-serif; }
        */
        body, html {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa; /* Lighter, softer page background */
            color: #495057; /* Default text color */
            line-height: 1.6;
        }

        .container {
            padding: 20px;
            max-width: 1600px; /* Max width for very large screens */
            margin: 0 auto; /* Center the container */
        }

        h1 {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 25px;
            color: #343a40; /* Darker grey for title */
            font-weight: 600;
            font-size: 2.2em;
        }

        #visualization {
            width: 100%;
            height: 85vh; /* Adjusted height */
            border: 1px solid #dee2e6; /* Softer border color */
            background-color: #ffffff; /* White background for timeline */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Softer, more modern shadow */
            border-radius: 8px; /* Rounded corners for the container */
        }

        /* General Item Styling */
        .vis-item {
            border-radius: 5px; /* Rounded corners for items */
            box-shadow: 0 2px 5px rgba(0,0,0,0.07); /* Subtle shadow for items */
            font-size: 0.9em;
            padding: 8px 10px; /* More padding inside items */
        }
        .vis-item .vis-item-content {
            padding: 0; /* Vis.js adds its own padding, adjust if needed */
        }

        /* Custom styling for different groups - refined palette */
        .vis-item.personal {
            background-color: #E0F2FE; /* Lighter blue */
            border-color: #A5D8FF;
            color: #075985; /* Darker text for better contrast */
        }
        .vis-item.education {
            background-color: #D4EDDA; /* Lighter green */
            border-color: #A3D9A5;
            color: #166534;
        }
        .vis-item.career {
            background-color: #FFF3CD; /* Lighter yellow */
            border-color: #FFE08C;
            color: #7A4F01;
        }
        .vis-item.research {
            background-color: #FFEADD; /* Lighter orange/peach */
            border-color: #FFCDB2;
            color: #7C2D12;
        }
        .vis-item.publication {
            background-color: #F8D7DA; /* Lighter pink/red */
            border-color: #F1AEB5;
            color: #8C1C13;
        }
        .vis-item.interests {
            background-color: #E9D8FD; /* Lighter purple */
            border-color: #D0B0FF;
            color: #5B21B6;
        }

        /* Group Labels Styling */
        .vis-group {
            font-weight: 500;
            color: #495057;
            padding-left: 10px !important; /* Ensure some padding for group labels */
        }
        
        /* Tooltip Styling */
        .vis-tooltip {
            background-color: #343a40 !important; /* Dark background for tooltip */
            color: #f8f9fa !important; /* Light text for tooltip */
            border: none !important;
            border-radius: 5px !important;
            padding: 8px 12px !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
            font-size: 0.9em !important;
        }

        /* Vis.js specific overrides if needed */
        .vis-timeline {
            border-radius: 8px; /* Ensure timeline itself respects container rounding */
        }
        .vis-panel.vis-center, .vis-panel.vis-left, .vis-panel.vis-right, .vis-panel.vis-top, .vis-panel.vis-bottom {
             border-color: #e9ecef; /* Lighter lines within timeline */
        }
        .vis-time-axis .vis-grid.vis-major {
            border-color: #ced4da; /* Slightly more prominent major grid lines */
        }
         .vis-time-axis .vis-text {
            color: #6c757d; /* Softer color for axis text */
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Professor Michael McIntyre - A Life in Science</h1>
        <div id="visualization"></div>
    </div>

    <script type="text/javascript">
        const lifeStoryData = { // ... (Your full JSON data remains here - unchanged)
  "interviewee_details": {
    "name": "Professor Michael McIntyre",
    "dob": "1941-07-28",
    "pob": "Sydney, Australia",
    "interview_reference": "C1379/72",
    "interview_context": "National Life Stories - An Oral History of British Science"
  },
  "family_background": {
    "paternal_side": {
      "father": {
        "name": "Archibald Keverall McIntyre",
        "occupation": "Neurophysiologist, respected scientist",
        "wwii_service": "Aviation physiology (note: interviewee clarifies early misconceptions about g-suits and UK service during the war in the transcript)",
        "education": "Medical training, Barker College (Sydney)",
        "childhood": "Born Edinburgh, moved to Tasmania (Launceston)",
        "health": "Heavily myopic"
      },
      "grandfather": "Gynaecologist, studied in Edinburgh",
      "great_aunt": "Molly (Mary Edgeworth David)",
      "great_grandfather": {
        "name": "Sir Edgeworth David FRS",
        "occupation": "Geologist, Antarctic explorer",
        "achievements": "Named South Magnetic Pole (temporarily), Funafuti atoll expedition (testing Darwin's theory)"
      },
      "great_grandmother": {
        "name": "Cara David",
        "achievements": "Wife of Sir Edgeworth, author, Funafuti expedition"
      }
    },
    "maternal_side": {
      "mother": {
        "name": "Anne (née Williams)",
        "description": "Kind, loving, restrained, artistic (painter, drawer), designed family homes, interested in architecture (Bauhaus).",
        "family_history": "Lawyers and business people in Sydney. Ancestor James Milson Senior (Milson's Point)."
      },
      "maternal_grandfather": "Keith Williams, affected by 1929 crash."
    },
    "siblings": {
      "sister": {
        "name": "Margaret",
        "description": "Accomplished sportswoman, ski instructor, Feldenkrais therapist, lives in Hawaii."
      },
      "brother": {
        "name": "Richard",
        "occupation": "Surgeon",
        "passion": "Winemaker (Moorooduc, Mornington Peninsula, Australia)"
      }
    }
  },
  "early_life_and_education": {
    "early_childhood_memories": [
      {
        "location": "Sydney (Cremorne with maternal grandparents, Manly Beach) and Tasmania (Launceston with paternal family) during WWII.",
        "details": "Fascination with Sydney Harbour steam ferries (triple-expansion engines), learning to dog paddle at Manly, oil from war ships, making smooth mud in Tasmania, pet dog Sidi, light box from father."
      },
      {
        "location": "Sydney (Hunters Hill house, \"Haldane\") post-WWII.",
        "details": "Listening to Beethoven symphonies (especially 5th) on 78rpm records, observing father's hi-fi equipment (vacuum tubes, oscilloscope), making an acoustic gramophone with father."
      }
    ],
    "primary_schooling": [
      {
        "location": "Sydney",
        "school_name": "Kindergarten run by Miss Budden (sp?)",
        "memories": "Musical experience with piano, learning to read (*Angus and the Cat*, *Pretzel*)."
      },
      {
        "location": "Yonkers, New York, USA (approx. 1946-1948)",
        "school_name": "PS16 (Public School 16)",
        "memories": "Rigid arithmetic, \"ball\" class (bouncing balls to music), American Oath of Allegiance, making model aeroplanes with father from a book (led to flying dreams)."
      },
      {
        "location": "Cambridge, UK (approx. 1948-1949)",
        "school_name": "Newnham Croft School",
        "memories": "Learning pounds, shillings, pence; cycling to school; given a recorder and composed tunes; attending concerts (King's Chapel choir, first symphony orchestra at Guildhall)."
      },
      {
        "location": "Dunedin, New Zealand (from 1949)",
        "school_name": "George Street Normal School (primary)"
      }
    ],
    "intermediate_schooling_nz": {
      "school_name": "Macandrew Intermediate School, Dunedin",
      "details": "First and Second Form (ages approx. 11-13). Strict teacher Miss Foster (grammar). Experienced some bullying ('Teacher's Pet'). Sang in choir. Encountered Euclidean geometry (beauty of abstract proof)."
    },
    "high_school_nz": {
      "school_name": "King's High School, Dunedin",
      "details": "Science teaching was standard. Active in electronics (vacuum-tube circuits). Socially accepted through sport (fives) and music (arranging and playing for Gilbert & Sullivan's *HMS Pinafore*). Influential maths teacher Gabby Haase (Additional Mathematics). Won scholarship to university."
    },
    "university_otago_nz": {
      "degree": "BSc with Honours in Mathematics (4 years)",
      "college_life": "Lived in Knox College. Cycled to 8am lectures. Studied maths, physics, chemistry in first year, then specialized in maths (more pure than applied due to better lecturing).",
      "friendships": "Roommate Max Restieaux (law, singer). John Anderson (father's student, married childhood friend Jenny Manton).",
      "extracurricular": "Intensive violin practice (founder member and leader of NZ National Youth Orchestra for three years)."
    }
  },
  "phd_and_early_career": {
    "phd_cambridge": {
      "institution": "University of Cambridge, Trinity College",
      "supervisor": "Francis Bretherton (nudged by George Batchelor, HOD)",
      "field": "Geophysical Fluid Dynamics",
      "research_transition": "Learning to appreciate simple things, orders of magnitude, and that not understanding everything is normal in research.",
      "thesis_topics": [
        "Stability of zonal flow on an aquaplanet, including nonhydrostatic effects in annular lab experiments (used EDSAC II computer).",
        "Wavy instability of a jet-like flow (vertical and horizontal shear), correcting work by Joseph Pedlosky. This involved complex paper mathematics and computing, and led to a JFM 1970 paper and a St John's Research Fellowship."
      ],
      "challenges": "Took an extra year due to intense involvement in Cambridge_musical_life.",
      "personal_life": "Met future wife, Ruth Hecht (pianist), who had 3 children. She provided accommodation during his 4th PhD year. Married the year after PhD completion."
    },
    "postdoc_mit": {
      "period": "Approx. 2 years (likely 1967-1969 based on other dates, but interviewee seems to adjust this later based on PhD finish and Cambridge start)",
      "location_details": "Brookline, MA. Family joined for second year. Involved house swap and extensive camping trips across USA.",
      "department_milieu": "Green Building, Meteorology Department. Key figures: Jule Charney, Norman Phillips. Legacy of Rossby. Intellectual freedom. Rotating seminars (MIT, Woods Hole, etc.).",
      "research_topics": [
        "Double-diffusive instability (related to a Princeton computer experiment on cellular motions).",
        "Equatorial undercurrent (unpublished work)."
      ]
    },
    "return_to_cambridge_academic_career": {
      "initial_appointment": "Assistant Director of Research, Department of Applied Mathematics and Theoretical Physics (DAMTP), October 1969 (following MIT postdoc).",
      "later_appointment": "Lectureship (tenure-track position).",
      "fellowship": "St John's Research Fellowship (won based on PhD thesis work)."
    }
  },
  "major_research_themes_and_contributions": {
    "musical_acoustics": {
      "collaboration": "With PhD student Jim Woodhouse (now Professor of Engineering).",
      "topics": "Violin acoustics, bowed string mechanics (finite width of bow, 'grit', two-hair model), wood properties (anisotropic), wolf notes, stick-slip mechanism, hysteresis ('flattening effect').",
      "context": "Influenced by Carleen Hutchins and the Catgut Acoustical Society."
    },
    "wave_mean_flow_interaction_and_glm_theory": {
      "development": "Followed Francis Bretherton's lead; developed Generalised Lagrangian-Mean (GLM) theory with student David Andrews.",
      "core_concept": "Hybrid Eulerian-Lagrangian description, importance of Kelvin's circulation theorem, defining wave breaking via irreversible deformation of material contours.",
      "eureka_moment": "An idea for the 'transformed Eulerian mean' occurred at a sidewalk café in Nice.",
      "applications": [
        { "type": "Water waves", "details": "mean surface height changes, radar altimetry, *On the Divergence Effect* paper" },
        { "type": "Mountain lee waves", "details": "upstream influence, correcting Brooke Benjamin, JFM 1972 paper" },
        { "type": "Quasi-Biennial Oscillation (QBO)", "details": "in the equatorial stratosphere (refining existing theory using GLM)" }
      ]
    },
    "stratospheric_dynamics_and_ozone_science": {
      "initial_interest": { "details": "Stratospheric Rossby waves (with student Adrian Simmons, correcting Dickinson's work), shear instability (correcting Charney & Stern 1962, QJRMS 1972 paper)" },
      "sudden_stratospheric_warmings": "Inspired by Taroh Matsuno's simulations; investigating how linear theory could work so well for large-amplitude Rossby wave phenomena.",
      "potential_vorticity_pv": {
        "significance": "Key to understanding large-scale atmospheric dynamics, including Rossby waves and their breaking.",
        "visualization": "PV maps provided a 'blurred view of reality' (McIntyre & Palmer, Nature 1983,4,5), later refined. Led to influential review (Hoskins, McIntyre & Robertson, 1985)."
      },
      "brewer_dobson_circulation": "Explained its driving mechanism via breaking Rossby waves and gyroscopic pumping, crucial for understanding trace constituent transport (e.g., ozone, water vapour).",
      "ozone_hole": {
        "context": "Discovery by Farman, Shanklin, Gardiner (1985). Understanding involved interdisciplinary effort (fluid dynamics, chemistry, radiation). Heterogeneous chemistry on PSCs.",
        "role": "Consultant theoretician on NASA DC-8 for Arctic airborne expedition (second expedition, following the first to Antarctica). Focused on fluid dynamics of vortex isolation (eddy-transport barrier)."
      }
    },
    "solar_physics_helioseismology": {
      "initial_exposure": "Through friends Edward Spiegel and Douglas Gough.",
      "problem": "Sun's differential rotation: radiative interior rotates solidly, convection zone differentially, sharp shear layer (tachocline).",
      "contribution": "Argued against Spiegel & Zahn's (1992) horizontal turbulence theory. Proposed internal global-scale magnetic field as necessary for solid interior rotation (McIntyre & Gough, Nature 1998). Theory of polar downwelling confining the field (with Toby Wood, JFM 2011)."
    },
    "jupiter_s_jets": {
      "observation": "Jupiter's jets are extremely straight, unlike Earth's meandering jets.",
      "hypothesis": "Different mechanism than terrestrial PV mixing; likely related to thunderstorms injected from below. Ongoing work with student Stephen Thomson."
    },
    "lucidity_in_scientific_communication": {
      "origins": "Proofreading George Batchelor's textbook, noticing judicious use of repetition, interest in perception psychology (Richard Gregory's *The Intelligent Eye*), correcting student drafts (e.g., Rupert Ford).",
      "principles": "Making complex ideas clear and accessible, using appropriate repetition, understanding perception, importance of multiple perspectives (equations, pictures, feel), civilised proof structure (Littlewood).",
      "outputs": "Three major papers, handout notes for lectures (e.g., group theory), website content."
    },
    "numerical_weather_forecasting_nwp": {
      "vision": "Advocated for using PV visualization to aid human forecasters ('A Dream/Vision of the Future' essays), combining human intuition with computer models.",
      "context": "Acknowledges automation but sees potential for human skill in spotting forecast errors and improving models via PV insights (e.g., Philippe Arbogast's PV inverter)."
    }
  },
  "other_interests_and_reflections": {
    "music": {
      "instrument": "Violin (started age 10), piano.",
      "experience": "Intense practice, NZ National Youth Orchestra (leader), Cambridge musical life (Music Club, CUMS, *Pierrot Lunaire* on viola), professional piano trio with wife Ruth (post-PhD), David Crighton memorial concert (2001), amateur chamber music.",
      "philosophy": "Music as spiritual solace, deep connection between maths and music (unconscious power of abstraction, organic change, invariant elements), importance of 'play' and 'feeling' in music."
    },
    "gliding_and_flight": {
      "early_interest": "Childhood flying dreams, model aeroplanes, book *Flight without Power* (Philip Wills).",
      "simulation": "Obsessive practice with 'Aviator' program on BBC Microcomputer.",
      "practical_experience": "Trial flight with Murry Salby (USA). Joined Cambridge Gliding Club, soloed in 1990. Active for ~10 years. Achieved Bronze C, partial Silver C.",
      "connection_to_science": "Thrill of feeling atmospheric motion, albeit smaller scale than professional work."
    },
    "home_and_family_life": {
      "marriage": "To Ruth Hecht, pianist; 3 stepchildren (Jonathan, Peter, Miriam).",
      "parenting_style": "Responsive to children's interests, encouraging scientific exploration (model making, Meccano).",
      "work_life_balance": "A struggle, especially during intense musical periods. Concertising eventually became unsustainable alongside scientific career.",
      "home_projects": "Keen on DIY, renewable energy (solar photovoltaic, advanced solar-thermal system), involved learning complex manuals."
    },
    "views_on_science_communication_and_academia": {
      "scientific_ethic": "Importance of honesty, cross-checking, lucidity, making things 'very obvious and trivial' (Adams-Airy affair lesson).",
      "research_style": "Often curiosity-driven, scientific opportunism, preference for solitude and deep thought, but values collaboration.",
      "teaching_style": "Developed from initial struggles to using detailed handout notes with overhead projector, focusing on highlighting key concepts. Importance of making material accessible.",
      "frs_election_1990": "Pleasing honour, brings responsibilities (refereeing), helped David Crighton get elected."
    },
    "climate_change_perspectives": {
      "engagement": "Watched closely, talks to IPCC colleagues, never directly funded for climate science.",
      "stance": "Clear that honest climate science exists and is reported by IPCC. Resents disinformers.",
      "key_argument": "Emphasizes palaeoclimate record (800,000yr ice cores showing CO2 180-280ppm correlating with large climate shifts). CO2 as crucial non-condensing greenhouse gas. Earth system as a powerful, slow-responding amplifier. Current CO2 levels already exceed natural range.",
      "solutions": "Adaptation likely more prominent than mitigation. Carbon capture possible. Business entrepreneurship for low-carbon economy (Stern, Branson). Politics too short-term."
    },
    "personal_philosophy_and_politics": {
      "religious_views": "Reverent agnostic, admires Quaker movement but it didn't provide enough spiritual solace. Disagrees with fundamentalism of any kind (including Dawkins' certainty of no God). Sees value in hope and belief for human societies.",
      "political_views": "Generally left-leaning. Critical of neocon mentality and sensationalist journalism. Values moderation and trust-building between cultures. Believes democracy is 'worst political system, apart from all the rest'."
    },
    "website_and_digital_presence": {
      "origins": "Early internet adoption for sharing prepublication papers.",
      "content": "Scientific papers, preprints, 'rants' (e.g., on carbon dioxide, lucidity principles page with 'walking lights' animation).",
      "philosophy": "A place for 'bees in one's bonnet to buzz' (quoting Hermann Bondi). Aims to communicate discoveries.",
      "challenges": "Haphazard layout, copyright issues for formal archiving (DSpace). Hopes for mirroring by interested parties to ensure posterity."
    }
  },
  "key_figures_mentioned": [
    "Archibald Keverall McIntyre (father)",
    "Anne McIntyre (mother, née Williams)",
    "Sir Edgeworth David (great-grandfather)",
    "Cara David (great-grandmother)",
    "Molly (Mary Edgeworth David, great-aunt)",
    "Ruth McIntyre (née Hecht, wife)",
    "Jim Woodhouse (PhD student, collaborator in acoustics)",
    "David Andrews (PhD student, collaborator on GLM theory)",
    "Francis Bretherton (PhD supervisor)",
    "George Batchelor (HOD Cambridge, author)",
    "Jule Charney (MIT, pioneering meteorologist)",
    "Norman Phillips (MIT, pioneering meteorologist)",
    "Fred Hoyle (astrophysicist, DAMTP)",
    "Hermann Bondi (astrophysicist, DAMTP)",
    "Joseph Pedlosky (meteorologist)",
    "Brooke Benjamin (fluid dynamicist)",
    "Adrian Simmons (first PhD student)",
    "Bob Dickinson (meteorologist)",
    "Taroh Matsuno (meteorologist)",
    "Tim Palmer (Met Office, collaborator on PV maps)",
    "Brian Hoskins (Reading, collaborator on PV review)",
    "Joseph Farman (discoverer of ozone hole)",
    "Jim Anderson (Harvard, chlorine monoxide measurements)",
    "John Houghton (Oxford, IPCC, satellite instrumentation)",
    "Nick Shackleton (palaeoclimatologist, musician)",
    "David Crighton (HOD Cambridge, mathematician, musician)",
    "Edward Spiegel (solar physicist)",
    "Douglas Gough (helioseismologist)",
    "Toby Wood (research student, solar physics)",
    "Stephen Thomson (research student, Jupiter's jets)",
    "Richard Gregory (perception psychologist)",
    "J.E. Littlewood (mathematician)",
    "Rupert Ford (brilliant PhD student, d. young)"
  ],
  "meta_interview_details": {
    "interview_experience": "Found it fun, a good way to jog memories, valuable exercise in explaining complex work in lay terms. Honoured by the British Library's interest."
  }
};

        const items = new vis.DataSet([]);
        let itemId = 1;

        function addEvent(content, startDate, endDate = null, group = 'general', type = 'point', className = '') {
            const event = {
                id: itemId++,
                content: content,
                start: startDate,
                group: group,
                type: type,
                title: `<b>${group.charAt(0).toUpperCase() + group.slice(1)} Event</b><br>Date: ${startDate}${endDate ? ' to ' + endDate : ''}<br><hr style='margin: 4px 0; border-color: #6c757d60;'>Details: ${content.replace(/\n/g, "<br>")}`, // Tooltip with HTML
                className: className || group // Assign group name as class for CSS styling
            };
            if (endDate) {
                event.end = endDate;
                if (type !== 'background') event.type = 'range';
            }
            items.add(event);
        }

        // Helper function to parse dates (simplified - adjust as needed for more complex date strings)
        function parseApproxDate(dateStr) {
            if (!dateStr) return null;
            // Try YYYY-MM-DD
            let match = dateStr.match(/^(\d{4}-\d{2}-\d{2})$/);
            if (match) return match[1];

            // Try "approx. YYYY-YYYY" -> use start of first year
            match = dateStr.match(/approx\. (\d{4})-(\d{4})/);
            if (match) return `${match[1]}-01-01`;

            // Try "from YYYY" -> use start of that year
            match = dateStr.match(/from (\d{4})/);
            if (match) return `${match[1]}-01-01`;
            
            // Try "Month YYYY" (e.g. October 1969)
            match = dateStr.match(/([A-Za-z]+) (\d{4})/);
            if(match){
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                const monthIndex = monthNames.findIndex(m => m.toLowerCase() === match[1].toLowerCase());
                if(monthIndex > -1){
                    return `${match[2]}-${String(monthIndex+1).padStart(2,'0')}-01`;
                }
            }
            
            // Try just YYYY -> use start of that year
            match = dateStr.match(/^(\d{4})$/);
            if (match) return `${match[1]}-01-01`;
            
            return dateStr; // Fallback to original string if no pattern matches
        }


        // --- Data Extraction Logic (largely unchanged, but uses new parseApproxDate and className) ---

        // Personal Details
        if (lifeStoryData.interviewee_details && lifeStoryData.interviewee_details.dob) {
            addEvent(`Born in ${lifeStoryData.interviewee_details.pob}`, parseApproxDate(lifeStoryData.interviewee_details.dob), null, 'personal');
        }

        // Education
        if (lifeStoryData.early_life_and_education) {
            const edu = lifeStoryData.early_life_and_education;
            edu.primary_schooling.forEach(school => {
                let startDate, endDate;
                if (school.location.includes("Yonkers")) { // approx. 1946-1948
                    startDate = '1946-01-01'; endDate = '1948-12-31';
                } else if (school.location.includes("Cambridge, UK")) { // approx. 1948-1949
                    startDate = '1948-01-01'; endDate = '1949-12-31';
                } else if (school.location.includes("Dunedin, New Zealand") && school.school_name.includes("George Street")) { // from 1949
                    startDate = '1949-01-01';
                }
                if(startDate) addEvent(`Primary: ${school.school_name}, ${school.location.split('(')[0].trim()}`, startDate, endDate, 'education');
            });
            if (edu.university_otago_nz) {
                const dobYear = lifeStoryData.interviewee_details.dob ? parseInt(lifeStoryData.interviewee_details.dob.substring(0,4)) : 1941;
                const uniStartYear = dobYear + 18; // Approx uni start age
                addEvent(`BSc Maths, Uni. of Otago (Leader, NZ Youth Orch.)`, `${uniStartYear}-03-01`, `${uniStartYear + 3}-11-30`, 'education');
            }
        }

        // PhD and Early Career
        if (lifeStoryData.phd_and_early_career) {
            const phdCareer = lifeStoryData.phd_and_early_career;
            let phdEndDateYear;
            if (phdCareer.phd_cambridge) {
                // Based on context: Postdoc MIT "likely 1967-1969", return to Cambridge Oct 1969.
                // PhD likely 1963-1967.
                const phdStart = '1963-10-01';
                const phdEnd = '1967-08-31';
                phdEndDateYear = 1967;
                addEvent(`PhD Geophysical Fluid Dynamics, Cambridge. Thesis on zonal flow & jet instability.`, phdStart, phdEnd, 'career');
                
                if (phdCareer.phd_cambridge.personal_life && phdCareer.phd_cambridge.personal_life.includes("Married the year after PhD completion")) {
                    if (phdEndDateYear) {
                        const marriageYear = phdEndDateYear + 1;
                        addEvent(`Married Ruth Hecht`, `${marriageYear}-06-01`, null, 'personal'); // Assume mid-year
                    }
                }
            }
            if (phdCareer.postdoc_mit && phdCareer.postdoc_mit.period.includes("1967-1969")) {
                 addEvent(`Postdoc at MIT (Meteorology Dept.) Research on double-diffusive instability.`, '1967-09-01', '1969-08-31', 'career');
            }
            if (phdCareer.return_to_cambridge_academic_career && phdCareer.return_to_cambridge_academic_career.initial_appointment) {
                const appointmentText = phdCareer.return_to_cambridge_academic_career.initial_appointment;
                if (appointmentText.includes("October 1969")) {
                     addEvent(`Asst. Director of Research, DAMTP, Cambridge`, '1969-10-01', null, 'career');
                }
            }
        }
        
        // Major Research Themes and Contributions
        if (lifeStoryData.major_research_themes_and_contributions) {
            const research = lifeStoryData.major_research_themes_and_contributions;

            if (research.wave_mean_flow_interaction_and_glm_theory && research.wave_mean_flow_interaction_and_glm_theory.applications) {
                research.wave_mean_flow_interaction_and_glm_theory.applications.forEach(app => {
                    if (app.details && app.details.includes("JFM 1972 paper")) {
                        addEvent(`Pub: Mountain lee waves (JFM)`, parseApproxDate('1972'), null, 'publication');
                    }
                });
            }
            if (research.stratospheric_dynamics_and_ozone_science) {
                const strato = research.stratospheric_dynamics_and_ozone_science;
                if (strato.initial_interest && strato.initial_interest.details && strato.initial_interest.details.includes("QJRMS 1972 paper")) {
                     addEvent(`Pub: Shear instability (QJRMS)`, parseApproxDate('1972'), null, 'publication');
                }
                if (strato.potential_vorticity_pv && strato.potential_vorticity_pv.visualization) {
                    if (strato.potential_vorticity_pv.visualization.includes("Nature 1983")) {
                        addEvent(`Pub: PV Maps (Nature, McIntyre & Palmer)`, parseApproxDate('1983'), null, 'publication');
                    }
                     if (strato.potential_vorticity_pv.visualization.includes("Hoskins, McIntyre & Robertson, 1985")) {
                        addEvent(`Pub: PV Review (HMR85)`, parseApproxDate('1985'), null, 'publication');
                    }
                }
                if (strato.ozone_hole) {
                    if (strato.ozone_hole.context.includes("Discovery by Farman, Shanklin, Gardiner (1985)")){
                        addEvent(`Ozone Hole Discovery (Farman et al.)`, parseApproxDate('1985-05-16'), null, 'research'); // Specific date for Nature paper
                    }
                    if (strato.ozone_hole.role.includes("NASA DC-8 for Arctic airborne expedition")){
                         addEvent(`Consultant on NASA Arctic Expedition (Ozone Hole)`, parseApproxDate('1989-01-01'), parseApproxDate('1989-03-31'), 'research'); // AAOE II was Jan-Mar 1989
                    }
                }
            }
             if (research.solar_physics_helioseismology && research.solar_physics_helioseismology.contribution) {
                if (research.solar_physics_helioseismology.contribution.includes("Nature 1998")) {
                    addEvent(`Pub: Solar Interior Rotation (Nature, McIntyre & Gough)`, parseApproxDate('1998'), null, 'publication');
                }
                if (research.solar_physics_helioseismology.contribution.includes("JFM 2011")) {
                    addEvent(`Pub: Polar Downwelling & Solar Field (JFM, with T. Wood)`, parseApproxDate('2011'), null, 'publication');
                }
            }
        }

        // Other Interests
        if (lifeStoryData.other_interests_and_reflections) {
            const interests = lifeStoryData.other_interests_and_reflections;
            if (interests.gliding_and_flight && interests.gliding_and_flight.practical_experience.includes("soloed in 1990")) {
                addEvent(`Soloed in Gliding (Cambridge Gliding Club)`, parseApproxDate('1990'), null, 'interests');
            }
             if (interests.music && interests.music.experience.includes("David Crighton memorial concert (2001)")) {
                addEvent(`Performed at David Crighton memorial concert`, parseApproxDate('2001'), null, 'interests');
            }
        }
        
        // Views on Science/Academia
        if (lifeStoryData.views_on_science_communication_and_academia && lifeStoryData.views_on_science_communication_and_academia.frs_election_1990) {
            addEvent(`Elected Fellow of the Royal Society (FRS)`, parseApproxDate('1990-06-21'), null, 'career'); // Actual election date for 1990 FRS
        }


        // DOM element where the Timeline will be attached
        const container = document.getElementById('visualization');

        // Define groups
        const groups = new vis.DataSet([
            // The className property in items will link to CSS for item background/border
            // Group labels are styled via .vis-group CSS
            {id: 'personal', content: 'Personal Life'},
            {id: 'education', content: 'Education'},
            {id: 'career', content: 'Career & Appointments'},
            {id: 'research', content: 'Research Activities'},
            {id: 'publication', content: 'Key Publications'},
            {id: 'interests', content: 'Other Interests'}
        ]);

        // Configuration for the Timeline
        const options = {
            stack: true,
            editable: false, 
            zoomMin: 1000 * 60 * 60 * 24 * 30 * 3, // Min zoom: ~3 months
            zoomMax: 1000 * 60 * 60 * 24 * 365 * 120, // Max zoom: ~120 years
            height: '100%',
            margin: {
                item: {
                    horizontal: 10, // Spacing between items
                    vertical: 5
                },
                axis: 20
            },
            tooltip: {
              followMouse: true,
              overflowMethod: 'flip',
              delay: 300, // Slight delay before tooltip appears
              template: function(itemData, element, data) {
                // itemData is the original data object of the item
                // element is the DOM element of the item
                // data is the original item data (same as itemData in this case)
                if (itemData && itemData.title) { // title was set in addEvent
                    return itemData.title;
                }
                return ''; // No tooltip if no title
              }
            },
            orientation: {axis: 'top'}, // Time axis on top
            // start: '1935-01-01', // Optional: Explicit start for timeline view
            // end: new Date(new Date().getFullYear() + 2, 0, 0), // Optional: Explicit end
            showCurrentTime: true, // Shows a line for the current date
            // groupOrder: function (a, b) { // Custom sort order for groups if needed
            //    const order = ['personal', 'education', 'career', 'research', 'publication', 'interests'];
            //    return order.indexOf(a.id) - order.indexOf(b.id);
            // }
        };

        // Create a Timeline
        const timeline = new vis.Timeline(container, items, groups, options);
        
        // Set a reasonable initial window if DOB is available
        if (lifeStoryData.interviewee_details && lifeStoryData.interviewee_details.dob) {
            const dob = new Date(parseApproxDate(lifeStoryData.interviewee_details.dob));
            const startDate = new Date(dob.getFullYear() - 2, dob.getMonth(), dob.getDate()); // 2 years before birth
            const endDate = new Date(dob.getFullYear() + 80, dob.getMonth(), dob.getDate()); // Up to age 80 initially
            try {
                timeline.setWindow(startDate, endDate, {animation: false});
            } catch (e) {
                console.error("Error setting timeline window:", e);
                // Fallback if dates are invalid
                const fallbackStart = new Date(1930,0,1);
                const fallbackEnd = new Date(2030,0,1);
                timeline.setWindow(fallbackStart, fallbackEnd, {animation: false});
            }
        } else {
             const fallbackStart = new Date(1930,0,1);
             const fallbackEnd = new Date(2030,0,1);
             timeline.setWindow(fallbackStart, fallbackEnd, {animation: false});
        }

    </script>
</body>
</html>
